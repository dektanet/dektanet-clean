<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

  <h1>Dashboard</h1>

  <p>DEKTA: <span id="dekta">0</span></p>
  <p>DEKTA-BOX: <span id="boxPrice">30</span></p>
  <p>Status: <b id="boxStatus">INACTIVE</b></p>

  <button id="activateBox">Activate BOX (30 DEKTA)</button>
  <br><br>
  <button id="logoutBtn">Logout</button>

  <!-- Firebase -->
  <script type="module" src="js/firebase.js"></script>

  <!-- Dashboard logic -->
  <script type="module">
    import { auth, db } from "./js/firebase.js";
    import {
      doc,
      getDoc
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
    import {
      onAuthStateChanged,
      signOut
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    const dektaEl = document.getElementById("dekta");
    const statusEl = document.getElementById("boxStatus");
    const logoutBtn = document.getElementById("logoutBtn");

    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        location.href = "login.html";
        return;
      }

      const ref = doc(db, "users", user.uid);
      const snap = await getDoc(ref);

      if (!snap.exists()) return;

      const data = snap.data();

      dektaEl.textContent = data.balances?.dekta ?? 0;
      statusEl.textContent = data.box?.status?.toUpperCase() ?? "INACTIVE";
    });

    logoutBtn.onclick = async () => {
      await signOut(auth);
      location.href = "login.html";
    };
  </script>

  <!-- Activate BOX -->
  <script type="module" src="js/activateBox.js"></script>

</body>
</html>
